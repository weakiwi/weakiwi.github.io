<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>weakiwi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="weakiwi">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="weakiwi">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="weakiwi">
  
    <link rel="alternative" href="/atom.xml" title="weakiwi" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://www.hi-pda.com/forum/uc_server/data/avatar/000/57/84/71_avatar_middle.jpg" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">weakiwi</a></h1>
		</hgroup>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		
		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="http://weakiwi.digitcv.com/#/resume">我的简历</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/weakiwi/" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/u/1750494183/home?wvr=5&lf=reg" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">奥巴马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">卡卡的美丽传说</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">本泽马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">吉格斯的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">习大大大不同</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">托蒂的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">weakiwi</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://www.hi-pda.com/forum/uc_server/data/avatar/000/57/84/71_avatar_middle.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">weakiwi</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="http://weakiwi.digitcv.com/#/resume">我的简历</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/weakiwi/" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/u/1750494183/home?wvr=5&lf=reg" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-new_spider_method" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/12/new_spider_method/" class="article-date">
  	<time datetime="2016-08-12T12:07:54.265Z" itemprop="datePublished">2016-08-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><h1 id="爬虫新玩法——通过队列来提高爬虫性能"><a href="#爬虫新玩法——通过队列来提高爬虫性能" class="headerlink" title="爬虫新玩法——通过队列来提高爬虫性能"></a>爬虫新玩法——通过队列来提高爬虫性能</h1><p>标签（空格分隔）： 爬虫</p>
<hr>
<p>事情的起因是亚马逊鞋品的新年优惠，其实这种所谓的优惠往往力度不大，然而再小的羊毛也是羊毛不是。因为商品太多，而且显示的还是优惠前的价格，所以人肉挑实在是太辛苦了，于是乎万能的py就必须启动了。</p>
<p>还是按照以往那样来进行需求分析：<br>1.获取优惠商品栏目下所有商品的超链接<br>2.获取这些商品的折后价格、星级还有热销排行榜，自己分别对其设置权数，算出一个综合评分。</p>
<p>，我们需要提取的商品链接的值是类似。class=’a-size-small a-color-secondary’下的，用bs4处理就好了，打开后的网页处理方法在之前的文章也提到过，在这里就不提了。这次最主要的是对爬虫的性能进行优化。</p>
<p>之前做过一个D版帖子的爬虫，也是这种先获取列表再打开类型的。一开始我采用的是非常单一的，获取完所有帖子的超链接然后再打开。唯一的优化就是采用多核心。这样做的缺点非常明显就是一单获取过程出错，后面对超链接包含内容的分析也无法进行。</p>
<p>其实最理想的处理方法就是每抓取一个超链接就分析一个超链接，百度之，发现这就是所谓的消费者生产者模型，用py现成的queue模块就能搞定。其实只要知道queue.put()是往队头插入一个元素，queue.get()是读取队尾元素并删除就好了。这样我们只要把获取超链接写成一个方法并存在队列里，对超链接的读取写成另一个方法，同时读取队列就好了。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-ndsl_1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/12/ndsl_1/" class="article-date">
  	<time datetime="2016-08-12T12:07:54.262Z" itemprop="datePublished">2016-08-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><h1 id="搞个大新闻！-——ndsl电池改造"><a href="#搞个大新闻！-——ndsl电池改造" class="headerlink" title="[搞个大新闻！]——ndsl电池改造"></a>[搞个大新闻！]——ndsl电池改造</h1><p>标签（空格分隔）： 电子</p>
<hr>
<p>好久没更新博客，所以就顺手做个大死，去掉ndsl的gba插槽然后塞进去一个bl5c，虽然存在电池互冲问题，但是容量也差不多能够增加百分之八十。</p>
<p>大概步骤：</p>
<ol>
<li>拆机清灰顺便换下导电胶</li>
<li>拆gba槽并且打磨后盖</li>
<li>并联不了bl5c与正负极</li>
<li>测试</li>
</ol>
<p>需要工具：</p>
<ol>
<li>拆机套件</li>
<li>电烙铁、焊锡、松香、漆包线（可以随便找条usb线去拆）等焊接工具</li>
<li>虎嘴钳、万用表</li>
<li>bl5c、海绵垫子（用来做绝缘和电池减震）、绝缘胶布、双面导电的金属铜箔（用来增大触点面积）</li>
<li>如果金钱富余建议买套备用壳，防止手贱拆坏了。</li>
</ol>
<p>拆机的话需要注意的不多，先取出所有卡，把D面所有螺丝全部卸完以后（主板上貌似还有固定螺丝），用手顶一下下屏主板就能出来了，注意别动着排线了。注意别把音量和开关机键给搞丢了，这是可以顺路把导电胶给换了（参见<a href="http://weakiwi.github.io/2015/08/10/ndsl/" target="_blank" rel="external">NDSL导电胶更换</a>）。<br>然后就是卸gba槽，因为我没有热风枪，有了也不会用，就直接用虎嘴钳来暴力拆解吧还有务必把槽上的金属片也卸掉。<br><img src="http://ww3.sinaimg.cn/large/68566be7gw1f1dwj5n8eij20qo0zk13t.jpg" alt="此处输入图片的描述"><br>先对中间用力，再对边上用力。注意别把主板弄坏了。最好能打磨一下D面对应gba槽的位置，为电池留够足够空间（防止焊点太大什么的）。<br><img src="http://ww1.sinaimg.cn/large/68566be7gw1f1dwj98hk9j20zk0qowmo.jpg" alt="此处输入图片的描述"><br>接下来是对电池的改造，如果你的bl5c的金属触点没有和它的塑料边缘齐平，请务必先打磨一下。这样贴铜箔的时候能保证接触足够充分。同时在铜箔上焊好漆包线，这些事情相对简单就不重复了。<br><img src="http://ww4.sinaimg.cn/large/68566be7gw1f1dwjbl4f7j20qo0qodll.jpg" alt="此处输入图片的描述"><br> 然后就是飞线到主板上的触点啦，首先确定你的漆包线和电池的连通性没问题，然后对电池做好绝缘处理，包一圈绝缘胶布。焊接的时候请务必在触点周围垫圈硬卡纸（一开始我用塑料片，熔点太低了，效果不好）。能防止我这一类的新手把焊锡滴到主板上。这一步完成后，再测试下触点两端是否为3.7v。<br> 测试是否成功有个简单的方法，当你并联好电池和触点后，可以插充电器充电，如果一直是红灯就说明成功了。这样之后就可以还原机器啦。顺便修一下完工图。<br> <img src="http://ww1.sinaimg.cn/large/68566be7gw1f1dwj3kormj20qo0zkjwr.jpg" alt="此处输入图片的描述"><br><img src="http://ww4.sinaimg.cn/large/68566be7gw1f1dwjal3dij20qo0zktgo.jpg" alt="此处输入图片的描述"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-howtosolve" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/12/howtosolve/" class="article-date">
  	<time datetime="2016-08-12T12:07:54.245Z" itemprop="datePublished">2016-08-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><h1 id="如何解决php跑大循环时候的内存耗尽问题"><a href="#如何解决php跑大循环时候的内存耗尽问题" class="headerlink" title="如何解决php跑大循环时候的内存耗尽问题"></a>如何解决php跑大循环时候的内存耗尽问题</h1><p>标签（空格分隔）： 爬虫</p>
<hr>
<p>最近认识到了php在和xpath以及mysql配合的方便性后，迫不及待地想找东西来练手。于是乎就盯上了超级玩家，而后更是惊喜地发现，该站没有做爬虫限制（连UA限制都没做），url又是非常的规律，于是就迫不及待地动手啦。</p>
<p>首先还是按惯例用chrome的xpath helper插件来对网页上的dom元素进行分析。</p>
<p>可以很快就得到对应的xpath路径，然后构造sql语句。然而这些都不是今天的重点（因为并不难啊）。<br>今天的重点是解决php的内存耗尽问题。</p>
<p>当用php跑一个大循环而且每次循环都会对数据库进行查询或者插入时，php就很容易内存耗尽。像最初的脚本，五十万的循环我仅仅是跑到三千多就停止了。至于问题是为何产生的，可以参考<a href="http://blog.csdn.net/beyondlpf/article/details/7794028" target="_blank" rel="external">PHP的内存限制 Allowed memory size of 134217728 bytes exhausted (tried to allocate 1099 bytes) in</a>以及<a href="http://developer.51cto.com/art/201510/493225.htm" target="_blank" rel="external">PHP大量数据循环时内存耗尽问题的解决方案</a>。</p>
<p>也就是说只要你每次查询都用ubuffered还有在php脚本一开始就加上<code>ini_set(&quot;memory_limit&quot;,&quot;521M&quot;);</code>就好了。然而我的脚本最后还是内存耗尽了，在百度一番后才知道是我的变量使用习惯不好。于是乎我在每次循环结束都用unset函数把变量全部释放感觉，最终这个五十万的大循环终于完完整地跑完了。其实想要进一步优化还有几个办法，比方说把整个循环拆分成若干个部分，每个部分结束就<code>mysql_close()</code>一下。又或者不要用老化的mysql模块。用新的mysqli也可能对性能有所提升</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-gmScripr" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/12/gmScripr/" class="article-date">
  	<time datetime="2016-08-12T12:07:54.234Z" itemprop="datePublished">2016-08-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><h1 id="油猴子脚本——豆瓣读书的图书馆插件（1）"><a href="#油猴子脚本——豆瓣读书的图书馆插件（1）" class="headerlink" title="油猴子脚本——豆瓣读书的图书馆插件（1）"></a>油猴子脚本——豆瓣读书的图书馆插件（1）</h1><p>标签（空格分隔）： 爬虫</p>
<hr>
<p>上学期就有的想法，昨天因为不想自己闲下来所以开始动手继续折腾。到今天位置也算做好大部分的内容了。也算是对假期学习php+js的一个总结吧。</p>
<p>需要的技术：</p>
<ol>
<li>油猴子脚本api——GM_xmlhttprequest（超好用！）；</li>
<li>xpath还有正则表达式（开启了新世界的大门啊喂！）；</li>
<li>xpathhelper（强大的chrome插件，以后做爬虫再也不用第三方的模块啦！）；</li>
</ol>
<p>简单的流程：</p>
<ol>
<li>获取豆瓣书籍名字；</li>
<li>提交到我的vps；</li>
<li>由我的vps向海事大学图书馆查询端口提交请求；</li>
<li>分析返回的请求再返回给脚本；</li>
<li>显示出来；</li>
</ol>
<p>差不多也就那么多事了，可以开始写代码了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ==UserScript==</span></div><div class="line"><span class="comment">// @name         豆瓣读书海事大学图书馆插件</span></div><div class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></div><div class="line"><span class="comment">// @version      0.1</span></div><div class="line"><span class="comment">// @description  一个用来在豆瓣读书页面显示大连海事大学图书馆相关藏书地以及借书号的脚本</span></div><div class="line"><span class="comment">// @author       weakiwi</span></div><div class="line"><span class="comment">// @match        https://book.douban.com/subject/*</span></div><div class="line"><span class="comment">// @grant        none</span></div><div class="line"><span class="comment">// @grant        GM_xmlhttpRequest</span></div><div class="line"><span class="comment">// ==/UserScript==</span></div></pre></td></tr></table></figure>
<p>首先看油猴子脚本开头的注释快，名称、作者、更新地址什么的都是一目了然。需要关心的是<code>@grant</code>还有<code>@match</code>前者是用来包含油猴子提供给你的内部函数的，后者是用来指定在那些页面下生效的。我需要在豆瓣读书下生效，所以对应的是<code>https://book.douban.com/subject/*</code>注意通配符。获取书籍名称非常容易，一行代码能够搞定，<code>var keyword1 = title.replace( &#39;(豆瓣)&#39;, &#39;&#39; ).trim();</code></p>
<p>接下来使用gm_xmlhttprequest模块构造get请求，提交书籍名称到我的vps。可以参考<a href="http://wiki.greasespot.net/GM_xmlhttpRequest" target="_blank" rel="external">greasepot的wiki</a>，不难写出代码，注意提交完成后的执行内容得写在onload里面。代码如下：<br>    function newztflh(book_name, book_location, book_ztflh) {<br>        this.book_name = book_name;<br>        this.book_location = book_location;<br>        this.book_ztflh = book_ztflh;<br>    }<br>    var ztflh = new newztflh(‘’,’’,’’);<br>    GM_xmlhttpRequest({<br>        method: “GET”,<br>        url: “”+keyword1,//请求的url<br>        synchronous : false,//是否为异步请求<br>        onload: function(response) {<br>            var obj = JSON.parse(response.responseText);<br>            if (obj.book_name == null) {<br>                ztflh.book_name = “找不到该书籍”;//抛出异常<br>            }<br>            else{<br>                ztflh.book_name = obj.book_name;<br>                ztflh.book_location = obj.book_location;<br>                ztflh.book_ztflh = obj.book_ztflh;<br>            }<br>            switch(location.host){//构造页面显示<br>                case “movie.douban.com”:<br>                    appendLinks(Movie_links, link)</p>
<pre><code>                link.append(&apos;&lt;br&gt;&apos;)
                    .append(&apos;&lt;span class=&quot;pl&quot;&gt;字幕链接:&lt;/span&gt;&apos;)
                    .append(
                        $(&quot;&lt;a&gt;&quot;).attr({
                            href: &quot;http://shooter.cn/search/&quot; + movieTitle,
                            target: &quot;_blank&quot;
                        }).html(&quot;Shooter&quot;)
                    );

                break;
            case &quot;book.douban.com&quot;:
                appendLinks(Book_links, link)                    
                link.append(&apos;&lt;br&gt;&apos;)
                    .append(&apos;&lt;span class=&quot;pl&quot;&gt;图书馆信息 :&lt;/span&gt;&apos;+ztflh.book_name+&apos; &apos;+ztflh.book_location+&apos; &apos;+ztflh.book_ztflh+&apos; &apos;+&apos;&lt;br/&gt;&apos;)
                break;
        }

        $(&apos;#info&apos;).append(link);
    }
});    
</code></pre><p>接下来是后端的内容，因为还不会用php的模块，所以直接用xpath来对页面进行解析。这里推荐xpathhelper，只需按下ctrl+shift+x再按下shift把鼠标移动到哪就可以显示对应的xpath，不过需要注意生成的是从根标签开始的，如果太长可以直接用”/“来代替。</p>
<p>最后是返回json数据（主要是看到v2ex上有人吐槽为何后端不能返回json数据，所以良好习惯从现在开始吧。我这数据量不大，老老实实组成数组，然后再用json_encode转换就好了。注意因为出现中文所以需要在开始加<code>header(&quot;Content-Type: text/html;charset=utf-8&quot;);//防止出现乱码</code><br>还有json_encode需要多一个参数<code>cho json_encode($arr, JSON_UNESCAPED_UNICODE);</code></p>
<p>js上再用json.parse取出就好了，实在方便的一匹啊。<br><img src="http://ww2.sinaimg.cn/large/68566be7gw1f1ql4amdlgj21hc0sxnan.jpg" alt="此处输入图片的描述"></p>
<p>todolist:</p>
<ol>
<li>返回的json增加错误代码（主要是图书馆最近在维护，希望能在后端直接判断出来）</li>
<li>生成的书籍信息更加好看一些（要是能像广州十校图书馆那样就好了）</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-4300" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/12/4300/" class="article-date">
  	<time datetime="2016-08-12T12:07:54.186Z" itemprop="datePublished">2016-08-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><h1 id="4300的一些折腾"><a href="#4300的一些折腾" class="headerlink" title="4300的一些折腾"></a>4300的一些折腾</h1><p>标签（空格分隔）： openwrt</p>
<hr>
<p>因为老豆那也要买一个路由器，在我的蛊惑之下，母亲大人终于拨款给家里换了一台网件4300。入手的原因是128m闪存、5gwifi、450m+300m、明月固件的支持。最后一项极大降低了折腾成本，最蛋疼的是usb竟然是1.1的，慢的让人差异。不过因为2楼的电源插座已经满了，再加上家里所谓的智能电视也不支持samba，所以最后可能还是得上树莓派。</p>
<p>todo list:<br>1.修改功率和信道，尽可能地保证全家wifi覆盖并全速上网（家里那台服役了三年的普联空心信号的情况很严重）<br>2.6in4隧道地搭建<br>3.去广告<br>4.dns本地缓存<br>5.单线多拨</p>
<p>1.第一项较为简单，直接在无线设定里面修改信道为13，功率改到最大就好了<br><img src="http://ww3.sinaimg.cn/large/68566be7gw1f0dvzrorcsj21gt0qhk4u.jpg" alt="此处输入图片的描述"><br>2.第二个主要的问题在于拨号获取的ip地址都是的动态的，而6in4隧道一般要求是静态的。还好openwrt本身支持he.net隧道的动态更新。可以参见<a href="http://tieba.baidu.com/p/2549523181" target="_blank" rel="external">【低级骗分】基于OpenWRT的6in4隧道架设研究</a>。注意opkg安装软件之前得先把源换成国内的然后执行一遍opkg update，防止出现一些莫名其妙的错误</p>
<p>3.去广告我用adbyby。安装方法<a href="http://www.adbyby.com/install.htm" target="_blank" rel="external">官网</a>讲得非常详细了，不过最后用下来感觉效果不是特别明显，但是有胜于无不是。</p>
<p>4.在网上找了说是可以用pdnsd，我直接勾了开启就没有管了，以后深入研究。</p>
<p>5.下面是重头戏，单线多拨。如果条件允许，你可以现在多台电脑上试一下能不能同时登一个账号而不掉线。如果不行直接创建虚拟网口来测试。<br><img src="http://ww1.sinaimg.cn/large/68566be7gw1f0dwdxghyij21h70q3k52.jpg" alt="此处输入图片的描述"><br>我一开始是创建了四个网口，创建完了切换到接口，设置pppoe拨号，输入自己的宽带账号密码，几个wan口都是如此设置。<br><img src="http://ww3.sinaimg.cn/large/68566be7gw1f0dwhenxmsj21hc0sbqeg.jpg" alt="此处输入图片的描述"><br>设置好了回到接口主界面，几个接口都点连接，看最后能有几个能拨上就是能几拨了。（某些运营商可能需要并发拨号才能成功，然而博主是直接双拨成功，相法使用并发不成功，所以需要并发的筒子们请自行折腾了）<br>多拨成功后别忘了勾选multiwan，确保能够叠加网速<br><img src="http://ww1.sinaimg.cn/large/68566be7gw1f0dwex03ddj21ha0ra4g3.jpg" alt="此处输入图片的描述"></p>
<p>最后，依旧是秀一波成果。20m叠加为40m，而且上行也有增加。<br><img src="http://ww3.sinaimg.cn/large/68566be7gw1f0dwlyrbsyj20jz0eb0w0.jpg" alt="此处输入图片的描述"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-pyFifaolScrpit" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/10/pyFifaolScrpit/" class="article-date">
  	<time datetime="2015-12-10T08:34:17.000Z" itemprop="datePublished">2015-12-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/10/pyFifaolScrpit/">pyFifaolScrpit</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><p> python</p>
<h1 id="用py写的fifaol3辅助脚本（2）"><a href="#用py写的fifaol3辅助脚本（2）" class="headerlink" title="用py写的fifaol3辅助脚本（2）"></a>用py写的fifaol3辅助脚本（2）</h1><p>标签（空格分隔）： python</p>
<hr>
<p>快要期末考了，所以填完这个坑以后也就扎银卡卸载游戏弃坑了。还有很多乱七八糟的坑要填啊。<br>这次主要介绍：</p>
<ol>
<li>应用pyhook获取鼠标坐标，做一个鼠标版的按键精灵</li>
<li>应用pyetesser来做ocr，实现当前拥有ep的检测</li>
</ol>
<p>经常上不了sourceforge，所以pyhook的帮助文档真是坑杀我也。需要注意的就是pyhook是用钩子的形式来获取键盘输入的，而鼠标模拟点击也同样是运用钩子的形式来进行的。虽然不是特别理解这钩子到底是什么，但是总之监听和模拟是不能同时进行。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">onWheel</span><span class="params">(event)</span>:</span></div><div class="line">    <span class="keyword">global</span> hm</div><div class="line">    nl = []</div><div class="line">    <span class="keyword">if</span> event.Wheel == <span class="number">-1</span>:</div><div class="line">        hm.UnhookMouse()</div><div class="line">        <span class="keyword">print</span> <span class="string">'stop recording...'</span></div><div class="line">        <span class="keyword">print</span> <span class="string">'after 5 sec it will start...'</span></div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">5</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>]:</div><div class="line">            <span class="keyword">print</span> i</div><div class="line">            time.sleep(<span class="number">1</span>)</div><div class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">            <span class="keyword">for</span> (x,y) <span class="keyword">in</span> mouseposition:</div><div class="line">                mouse_click(x,y)</div><div class="line">                time.sleep(distance)</div><div class="line">                <span class="keyword">print</span> <span class="string">'HIT!'</span></div><div class="line">            pressHoldRelease(<span class="string">'enter'</span>)</div><div class="line">            <span class="keyword">print</span> <span class="string">'ENTER!'</span></div><div class="line">            time.sleep(<span class="number">0.2</span>)</div><div class="line">            pressHoldRelease(<span class="string">'enter'</span>)</div><div class="line">            <span class="keyword">print</span> <span class="string">'ENTER!'</span></div><div class="line">            <span class="keyword">if</span> EXIT:</div><div class="line">                sys.exit()</div><div class="line">    <span class="keyword">return</span> <span class="keyword">True</span></div></pre></td></tr></table></figure></p>
<p>需要注意的就是其中的<figure class="highlight plain"><figcaption><span>true```也是绝对必要的。</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">处理完这个小问题，我就来谈谈我大概的解决思路啦——每次点击鼠标左键，就给两个全局变量添加参数，其中一个是当前鼠标的坐标，另一个则是```time.time()```后者是用来计算鼠标点击的时间间隔的，然后当鼠标中键往后滚动的时候脱钩，处理得到时间间隔，开始模拟点击。需要注意的是，按下鼠标左键以及中键对应的子类分别是```MouseLfetDown```以及```MouseWheel```具体的实现代码可以看[我的github][1]。</div><div class="line"></div><div class="line"></div><div class="line">还有就是ocr咯，我用的是pytesser。无他，不需要编译，不需要pip，使用起来方便（反正都是对付近似印刷体的纯数字，难度较低）。</div><div class="line">有了pytesser其他就都是小事了，直接调用就好了。贴下我的图片二值化代码以及提取纯数字的代码。</div><div class="line"></div><div class="line">```python</div><div class="line">#二值化</div><div class="line">def imgConvert(file):</div><div class="line">    im = Image.open(file)</div><div class="line">    im = im.convert(&quot;I&quot;)</div><div class="line">    im2 = Image.new(&quot;P&quot;,im.size,255)</div><div class="line">    for x in range(im.size[1]):</div><div class="line">        for y in range(im.size[0]):</div><div class="line">            pix = im.getpixel((y,x))</div><div class="line">            if pix&gt;50 and pix&lt;170: #这个区间是主要字体的颜色，可以通过qq截图获得</div><div class="line">                im2.putpixel((y,x),0)</div><div class="line">    im = im2</div><div class="line">    return im</div></pre></td></tr></table></figure></p>
<pre><code class="python"><span class="comment">#提取数字</span>
<span class="function"><span class="keyword">def</span> <span class="title">OnlyNum</span><span class="params">(s)</span>:</span>
    s = s.lower()<span class="comment">#去空格</span>
    format = <span class="string">'1234567890'</span>
    <span class="keyword">for</span> c <span class="keyword">in</span> s:
        <span class="keyword">if</span> <span class="keyword">not</span> c <span class="keyword">in</span> format:
            s = s.replace(c,<span class="string">''</span>)
</code></pre>
<p>最后照例秀下成果<br><img src="http://ww3.sinaimg.cn/large/68566be7gw1eyun8bu35vj20y80muwm0.jpg" alt="此处输入图片的描述"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-fifaolPyscript" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/11/29/fifaolPyscript/" class="article-date">
  	<time datetime="2015-11-29T06:02:42.000Z" itemprop="datePublished">2015-11-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/29/fifaolPyscript/">fifaolPyscript</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><p>python</p>
<p>#用py写的fifaol3辅助脚本（1）<br>标签（空格分隔）： python</p>
<hr>
<p>最近有些沉迷于fifaol3这网游啊，自己也不是那么极客的人，只不过之前做的东西用处都不大，这次得做些用处大的东西来更新我的博客。</p>
<p>##目标</p>
<ol>
<li>fifaol3截卡器，在转会市场，总是有一些卡，虽然明明存量很大，可是每次购买就是提示“该球员已售出”。这就是截卡器的功劳了。因此打算用python实现自动检测球员，自动购买球员，最好还能考虑价格问题。</li>
<li>fifaol3经理人脚本，其实自从出了fifaol3m，就不用刷经理人了，但是我倒霉的手机玩不了，再说也得主动多造轮子提升自己吗。需要的是自动点击按钮还有就是根据情况按下esc，跳过回放入场等。</li>
</ol>
<p>##需要用到的工具</p>
<ol>
<li>pywin32，这个不用说啦，用来获取窗口以及模拟鼠标和键盘事件</li>
<li>PIL，用来识别屏幕上的变化分析当前情况（是否有+1卡，是否在播放回放等等）</li>
<li>spy++，用来获取窗口句柄和类</li>
<li>windows自带画图，用来测量坐标。</li>
<li>qq截图，用来截图还有就是测量rgb值。</li>
</ol>
<p>##截卡器具体分析<br>其实就是不断重复买球员这个操作，这样怎么都能买得到，把操作间隔该低了就可以和一般用户抢卡啦。<br>首先为了方便测试，我们需要把fifaol调整为非全屏以及第分辨率，这样才能方便我切换窗口。<br>然后就是对购买球员的操作进行分析：<br>1.首先是切换窗口到fifaol3。<br>2.点击搜索球员——选中球员——点击购买——回车购买———回车确认。这里需要注意的就是能不用鼠标完成的操作（比如最后两步可以用回车键代替），尽量别用鼠标完成（因为鼠标需要各种测量，实在太辛苦）。如下图：<br><img src="http://ww1.sinaimg.cn/large/68566be7gw1eyhsz8cwarj21020nhthv.jpg" alt="此处输入图片的描述"></p>
<p>pywhin32在网上的资料还是很多的，直接找来就好了。直接贴下主程序的代码：</p>
<pre><code class="python"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    game_hwnd = win32gui.FindWindow(<span class="string">'FIFANG'</span>,<span class="string">'FIFA ONLINE3 - Developed by SPEARHEAD'</span>)<span class="comment">#fifaol3的窗口类和标题</span>
    win32gui.ShowWindow(game_hwnd, win32con.SW_RESTORE)<span class="comment">#窗口提前</span>
    win32gui.SetForegroundWindow(game_hwnd)
    game_rect = win32gui.GetWindowRect(game_hwnd)<span class="comment">#获取窗口的坐标，对应的是左上角坐标和右下角坐标</span>
    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):<span class="comment">#暂停五秒，方便用户把鼠标移动到搜索球员上</span>
        <span class="keyword">print</span> i
        time.sleep(<span class="number">1</span>)
    user_x,user_y = get_mouse_point()<span class="comment">#获取鼠标坐标</span>
    time.sleep(<span class="number">0.1</span>)
    moveAndclick(user_x, user_y)<span class="comment">#点击搜索球员（</span>
    time.sleep(<span class="number">1</span>)
    <span class="keyword">while</span>(<span class="number">1</span>):
            time.sleep(<span class="number">0.5</span>)
            moveAndclick(game_rect[<span class="number">0</span>]+<span class="number">579</span>, game_rect[<span class="number">1</span>]+<span class="number">226</span>)<span class="comment">#选中第一个球员</span>
            time.sleep(<span class="number">0.5</span>)
            moveAndclick(game_rect[<span class="number">0</span>]+<span class="number">717</span>, game_rect[<span class="number">1</span>]+<span class="number">572</span>)<span class="comment">#点击购买</span>
            time.sleep(<span class="number">0.5</span>)
            pressHoldRelease(<span class="string">'enter'</span>)<span class="comment">#回车确认购买</span>
            time.sleep(<span class="number">1</span>)
            pressHoldRelease(<span class="string">'enter'</span>)<span class="comment">#回车确认</span>
            time.sleep(<span class="number">0.5</span>)
            moveAndclick(user_x, user_y)<span class="comment">#点击搜索球员</span>
            time.sleep(<span class="number">3</span>)
</code></pre>
<p>缺点：</p>
<ol>
<li>没有价格识别，就是一个劲地买（一开始想截取+1图像作为区别，结果像素点太少，无论是rgb比较还是汉明距离相似度都特别高，估计只能读取内存了）</li>
<li>有时候fifaol会突然闪退回桌面，该脚本做不到再把窗口切换回去</li>
<li>操作间隔太小了fifaol会卡死。</li>
<li>不能检测延迟，只能靠不断重复来弥补。</li>
</ol>
<p>最后按照管理秀下成果吧！<br><img src="http://ww4.sinaimg.cn/large/68566be7gw1eyht3275gjj21020nhdnw.jpg" alt="此处输入图片的描述"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-betterhexo" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/11/06/betterhexo/" class="article-date">
  	<time datetime="2015-11-06T13:30:19.000Z" itemprop="datePublished">2015-11-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/06/betterhexo/">betterhexo</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><p>折腾categories: toc:true    因为最近找不到什么素材更新博客啦，所以就转头开始折腾博客本身吧。这次对于博客的折腾，主要分为一下方面：</p>
<ol>
<li>seo优化</li>
<li>增加统计功能</li>
<li>优化显示效果</li>
<li>丰富页面内容</li>
</ol>
<p>##seo优化<br>这里主要是添加sitemap被百度等网站收录以及添加robots.txt。参考：<br><a href="http://www.arao.me/2015/hexo-next-theme-optimize-seo/" target="_blank" rel="external">动动手指，不限于NexT主题的Hexo优化（SEO篇）</a><br><a href="http://lurrpis.com/5.html" target="_blank" rel="external">Hexo的SEO，标签转为关键词，搜索优化</a><br><a href="http://wanghuanming.com/2014/12/blog-seo/" target="_blank" rel="external">个人博客SEO实践</a></p>
<p>##增加统计功能<br>主要是用了不蒜子这个js统计脚本：<br><a href="http://ibruce.info/2015/04/04/busuanzi/" target="_blank" rel="external">不蒜子</a></p>
<p>##优化显示效果<br>主要是增加字体大小</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-football2sms" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/11/04/football2sms/" class="article-date">
  	<time datetime="2015-11-04T07:49:53.000Z" itemprop="datePublished">2015-11-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/04/football2sms/">football2sms</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><p>爬虫</p>
<h1 id="推送足球比分的一个爬虫"><a href="#推送足球比分的一个爬虫" class="headerlink" title="推送足球比分的一个爬虫"></a>推送足球比分的一个爬虫</h1><p>标签（空格分隔）： 爬虫</p>
<hr>
<p><a href="https://github.com/weakiwi/football2mail" target="_blank" rel="external">github地址在此</a><br>主要诱因是爆流量了，然后又刚好最近比赛密集，所以就想做一个能推送当日比赛成绩以及战报的小爬虫了。一开始目标是懂球帝，结果发现竟然是动态内容。后来终于让我找到了<a href="http://goal.sports.163.com/schedule/20151022.html" target="_blank" rel="external">网易体育</a>这个对于制作爬虫而言非常良心的网站。好了，既然有了网站我们就可以开始分析啦。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"> &lt;tr&gt;</div><div class="line">&lt;td&gt;11&lt;/td&gt;</div><div class="line">&lt;td&gt;02:45&lt;/td&gt;</div><div class="line">&lt;td&gt;完场&lt;/td&gt;</div><div class="line">&lt;td&gt;&lt;span class=&quot;c1&quot;&gt;&lt;a href=&quot;/58/team/7431.html&quot;&gt;马尔默&lt;/a&gt;&lt;img src=&quot;http://imgsize.ph.126.net/?imgurl=http://goal.sports.163.com/teamlogo/7431.png_20x20x1.jpg&quot; width=&quot;20&quot; height=&quot;20&quot; onerror=&quot;this.src=&apos;http://img1.cache.netease.com/sports/2009/goal/logo/default_team_20.gif&apos;&quot; /&gt;&lt;/span&gt;&lt;/td&gt;#主队</div><div class="line">&lt;td&gt;&lt;span class=&quot;c3&quot;&gt;&lt;a href=&quot;/58/match/stat/2015/1574739.html&quot; target=&quot;_blank&quot;&gt;1-0&lt;/a&gt;&lt;/span&gt;&lt;/td&gt;#比分</div><div class="line">&lt;td&gt;&lt;span class=&quot;c2&quot;&gt;&lt;img src=&quot;http://imgsize.ph.126.net/?imgurl=http://goal.sports.163.com/teamlogo/6457.png_20x20x1.jpg&quot; width=&quot;20&quot; height=&quot;20&quot; onerror=&quot;this.src=&apos;http://img1.cache.netease.com/sports/2009/goal/logo/default_team_20.gif&apos;&quot; /&gt;&lt;a href=&quot;/58/team/6457.html&quot;&gt;顿涅茨克矿工&lt;/a&gt;&lt;/span&gt;&lt;/td&gt;#客队</div><div class="line">&lt;td&gt;&amp;nbsp;&lt;/td&gt;</div><div class="line">&lt;td class=&quot;bg2 bg7&quot;&gt;</div><div class="line">	&lt;a href=&quot;/58/match/stat/2015/1574739.html&quot; target=&quot;_blank&quot;&gt;统计&lt;/a&gt; | &lt;span class=&quot;cur_hand&quot;  id=&quot;check_1574739_58_2015&quot; style=&quot;cursor: pointer;&quot; &gt;查看详细&lt;/span&gt; &lt;img src=&quot;http://img1.cache.netease.com/sports/2009/goal/slbg33.gif&quot; width=&quot;5&quot; height=&quot;13&quot; /&gt; | </div><div class="line">	</div><div class="line">&lt;a href=&quot;http://caipiao.163.com/order/preBet_jczqspfp.html&amp;&amp;t=2325#from=sj1&quot; target=&quot;_blank&quot;&gt;投注&lt;/a&gt;</div><div class="line"></div><div class="line"> &lt;/td&gt;</div><div class="line"> &lt;/tr&gt;</div></pre></td></tr></table></figure></p>
<p>从这段代码中不难看出。class=’c1’对应的是span标签的正文是主队，class=’c2’对应的则是客队，而class=’c3’对应的则是比分。然后接下来就可以形成代码啦！<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_bifeng</span><span class="params">(mytime)</span>:</span></div><div class="line"><span class="comment">#    date = '20151101'</span></div><div class="line">    date = mytime</div><div class="line">    goal_url = <span class="string">'http://goal.sports.163.com/schedule/'</span> + date + <span class="string">'.html'</span><span class="comment">#构成网址</span></div><div class="line">    response = urllib2.urlopen(goal_url)</div><div class="line">    page = response.read()</div><div class="line">    soup = BeautifulSoup(page)<span class="comment">#构造bs</span></div><div class="line">    tag_zhudui = soup.find_all(<span class="string">'span'</span>, <span class="string">'c1'</span>)</div><div class="line">    tag_kedui = soup.find_all(<span class="string">'span'</span>, <span class="string">'c2'</span>)</div><div class="line">    tag_bifeng = soup.find_all(<span class="string">'span'</span>, <span class="string">'c3'</span>)</div><div class="line">    temp_bifeng = []</div><div class="line">    bifeng = <span class="string">' '</span></div></pre></td></tr></table></figure></p>
<p>通过这段代码可以轻松得到主队，客队还有比分的列表。那么如何把三个列表合并并且格式化输出，我用的是比较简单的两个两个合并然后输出的方法，代码如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (i, j) <span class="keyword">in</span> zip(tag_zhudui, tag_bifeng):</div><div class="line">    temp_bifeng.append(i.get_text().encode(<span class="string">'utf-8'</span>) + <span class="string">' '</span> + j.get_text().encode(<span class="string">'utf-8'</span>) + <span class="string">' '</span>)</div><div class="line"><span class="keyword">for</span> (i, j) <span class="keyword">in</span> zip(tag_kedui, temp_bifeng):</div><div class="line">    bifeng += (j + <span class="string">' '</span> + i.get_text().encode(<span class="string">'utf-8'</span>)+<span class="string">'\n'</span>)</div><div class="line"><span class="keyword">return</span> bifeng</div></pre></td></tr></table></figure></p>
<p>这段函数有个缺陷就是偶尔会有当日没有结束的比赛，这就造成了，有主队和客队却没有对应的比分选项，以后再修这个bug。</p>
<p>接下来就是获取战报啦，咱们还是先分析网页的源码：</p>
<pre><code class="html"><span class="tag">&lt;<span class="name">tr</span>&gt;</span>
                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>11<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>02:45<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>完场<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
                    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"c1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/58/team/6409.html"</span>&gt;</span>巴黎圣日耳曼<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://imgsize.ph.126.net/?imgurl=http://goal.sports.163.com/teamlogo/6409.png_20x20x1.jpg"</span> <span class="attr">width</span>=<span class="string">"20"</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">onerror</span>=<span class="string">"this.src='http://img1.cache.netease.com/sports/2009/goal/logo/default_team_20.gif'"</span> /&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span>
                    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"c3"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/58/match/stat/2015/1574752.html"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>0-0<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span>
                    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"c2"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://imgsize.ph.126.net/?imgurl=http://goal.sports.163.com/teamlogo/6171.png_20x20x1.jpg"</span> <span class="attr">width</span>=<span class="string">"20"</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">onerror</span>=<span class="string">"this.src='http://img1.cache.netease.com/sports/2009/goal/logo/default_team_20.gif'"</span> /&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/58/team/6171.html"</span>&gt;</span>皇家马德里<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span>
                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&amp;nbsp;<span class="tag">&lt;/<span class="name">td</span>&gt;</span>
                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"bg2 bg7"</span>&gt;</span>#战报对应的标签在这里！
                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/58/match/report/2015/1574752.html"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>战报<span class="tag">&lt;/<span class="name">a</span>&gt;</span> | <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"cur_hand"</span>  <span class="attr">id</span>=<span class="string">"check_1574752_58_2015"</span> <span class="attr">style</span>=<span class="string">"cursor: pointer;"</span> &gt;</span>查看详细<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://img1.cache.netease.com/sports/2009/goal/slbg33.gif"</span> <span class="attr">width</span>=<span class="string">"5"</span> <span class="attr">height</span>=<span class="string">"13"</span> /&gt;</span> |
</code></pre>
<p>不难看出战报对应的标签为td下的class=’bg2 bg7’，然后形成代码：</p>
<pre><code class="python"><span class="function"><span class="keyword">def</span> <span class="title">get_zhanbao</span><span class="params">(mytime)</span>:</span>
<span class="comment">#    date = '20151101'</span>
    date = mytime
    goal_url = <span class="string">'http://goal.sports.163.com/schedule/'</span> + date + <span class="string">'.html'</span><span class="comment">#构成网址</span>
    response = urllib2.urlopen(goal_url)
    page = response.read()
    soup = BeautifulSoup(page)<span class="comment">#构造bs</span>
    tag = soup.find_all(class_=<span class="string">'bg2 bg7'</span>)<span class="comment">#查找对应标签</span>
    zhanbao = []
    mail_content = <span class="string">''</span>
    <span class="keyword">for</span> i <span class="keyword">in</span> tag:
        <span class="keyword">if</span> i.get_text().encode(<span class="string">'utf-8'</span>)[<span class="number">7</span>:<span class="number">13</span>] == <span class="string">'战报'</span>:<span class="comment">#判断关键字段为‘统计’还是‘战报’，这里注意utf-8三个值为一个汉字</span>
            zhanbao.append(<span class="string">'http://goal.sports.163.com'</span>+i.find(<span class="string">'a'</span>).get(<span class="string">'href'</span>))<span class="comment">#存储所有‘战报’的超链接</span>
<span class="comment">#    print zhanbao</span>
    <span class="keyword">for</span> i <span class="keyword">in</span> zhanbao:
        response = urllib2.urlopen(i)
        page = response.read()
        soup = BeautifulSoup(page)
        tag = soup.find_all(<span class="string">'b'</span>)<span class="comment">#在战报页面中，‘b’标签（加粗），对应的就是打门，这就是我所需要的啦。</span>
        <span class="keyword">if</span> tag == <span class="string">''</span>:
            <span class="keyword">break</span>
        <span class="keyword">for</span> i <span class="keyword">in</span> tag:
            mail_content += i.get_text().encode(<span class="string">'utf-8'</span>)+<span class="string">'|'</span><span class="comment">#构造邮件内容</span>
            <span class="keyword">print</span> i
<span class="comment">#    print mail_content</span>
    <span class="keyword">return</span> mail_content
</code></pre>
<p>然后再写好函数部分，最后加到crontab里面就ok啦，至于邮箱，网上py发邮箱的方法很多，就不再啰嗦啦。</p>
<p>能够改进的地方：</p>
<ol>
<li>以后或许考虑直接推送处理好的html页面，这样可以包含更多更直观的数据（这样逼格高许多）</li>
<li>格式化输出那莫名其妙的空格问题</li>
<li>发邮件看看能不能一封战报一个邮件，这样最后到短信上的效果会好很多</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-aliyun" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/12/aliyun/" class="article-date">
  	<time datetime="2015-10-12T05:38:23.000Z" itemprop="datePublished">2015-10-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/12/aliyun/">aliyun</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><p>阿里云</p>
<h1 id="阿里云内核更新全过程"><a href="#阿里云内核更新全过程" class="headerlink" title="阿里云内核更新全过程"></a>阿里云内核更新全过程</h1><p>标签（空格分隔）： 阿里云</p>
<hr>
<p>九月份的时候突然得知阿里云云翼对大学生超级良心的优惠，算下来一年只需要70，虽然的确配置不咋滴还限制流量，但是毕竟便宜。不过买回来以后真的发觉不知道可以用来干啥，就当了下编程环境，然后跑了下爬虫。实在不甘心啊，这可是两顿鸡公煲的钱！于是打算手动更新内核咯，也为以后自己精简树莓派内核做准备咯。</p>
<p>1.需要准备的材料：<br>a.阿里云vps<br>b.最新的linux kernel<br>c.各种依赖包</p>
<p>2.大概的步骤<br>a.下载好需要的一切<br>b.make config<br>c.make<br>d.make install</p>
<p>好了，首先就是需要把所有的软件包更新到最新。插一段话，我因为编译比较无聊，所以顺手把阿里云盾卸载了（实在想不出谁会闲着没事搞我的主机，反正我有格盘大法我怕谁啊）。安利下彻底卸载阿里云云盾的方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wget http://update.aegis.aliyun.com/download/uninstall.sh</div><div class="line">chmod +x uninstall.sh</div><div class="line">sh uninstall.sh</div></pre></td></tr></table></figure></p>
<p>我直接执行反正提示什么循环变量出现问题，然后索性就把脚本里执行的命令复制出来，全部执行，最后再看下top，ok！</p>
<ol>
<li>首先就是去wget最新的kernel啦，<a href="https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.2.3.tar.xz" target="_blank" rel="external">地址在此！</a>。下载好后先用xz -d命令解压，再用tar -xf命令解压，得到内核文件夹。</li>
<li>理想中的情况应该是用/linux-4.3-rc4/scripts文件架下的extract-ikconfig脚本导出当前的内核配置然后再导入，这样既节省配置时间，而且相对来说也保险一些。然而我死活没有弄清楚该脚本的用法，于是直接make allyesconfig（启用所有的内核功能）。顺便提一下几种配置方法：<blockquote>
<p>make config           #遍历选择编译内核功能<br>make allyesconfig     #启用内核全部功能<br>make allnoconfig      #内核功能选项全部为否<br>make menuconfig       #开启文本菜单选项，对窗口有限制，尽量调大窗口，否则会出错</p>
<pre><code>#使用此命令需安装gcc和ncurses-devel
</code></pre><p>make gconfig          #依赖GNome桌面环境及GNome的图形开发环境，gtk2<br>make kconfig          #依赖KDE桌面环境及KDE的图形开发环境，qt</p>
</blockquote>
</li>
<li>配置完以后就可以直接make啦，然而竟然提示我<code>scripts/sign-file.c:23:30: fatal error: openssl/opensslv.h: No such file or directory</code>，最后得到的解决方法是<code>apt-get install libssl-dev</code>，果然执行完以后就可以顺利开始编译了。以后如果大家也遇到类似的问题，可以google一下所需要的依赖包或者库文件什么的。</li>
<li>最后附上的一些小意见。建议用<code>make -j 2</code>这样可以把阿里云的两个核心都用上，适当提高编译速度。还有就是可以安装下screen这个软件，然后输入screen再make，这样就算断开ssh也能继续编译啦。其中在screen命令新建的窗口中ctrl+a+d是隐藏窗口，<code>screen -ls</code>是列出所有窗口列表，<code>screen -r 窗口id</code>是切换窗口。</li>
<li>之后我就关了putty，让他在后台自己静静地编译了，第二天中午一下看迫不及待地打开一看，发现已经搞定了。于是输入<code>make modules_install || make install</code>，然后再次挂后台。之后直接查看/boot下面有没有编译好的最新镜像就ok啦。然而还有一件奇怪的事情就是虽然编译成功，但是系统仍不用最新的img启动，查看/boot/grub/grub.cfg也发现启动顺序改好了。没办法，使用移除老镜像大法——<code>apt-get remove 你的镜像版本</code>最后终于成功用4.3内核启动了，结尾照例贴图一张晒一晒。<img src="http://ww3.sinaimg.cn/large/68566be7gw1ewyai0dfdvj20nd0enn03.jpg" alt="此处输入图片的描述"></li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 weakiwi
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
            <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
            </script>
            </br>本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
            <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=298 height=52 src="http://music.163.com/outchain/player?type=0&id=108987177&auto=1&height=32"></iframe>
      	</div>
    </div>
  </div>
</footer>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="http://music.163.com/outchain/player?type=2&id=590883&auto=1&height=66"></iframe>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: undefined,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: undefined
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>
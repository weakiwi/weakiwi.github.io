<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>weakiwi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="weakiwi">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="weakiwi">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="weakiwi">
  
    <link rel="alternative" href="/atom.xml" title="weakiwi" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://www.hi-pda.com/forum/uc_server/data/avatar/000/57/84/71_avatar_middle.jpg" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">weakiwi</a></h1>
		</hgroup>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		
		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="http://weakiwi.digitcv.com/#/resume">我的简历</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/weakiwi/" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/u/1750494183/home?wvr=5&lf=reg" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">奥巴马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">卡卡的美丽传说</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">本泽马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">吉格斯的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">习大大大不同</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">托蒂的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">weakiwi</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://www.hi-pda.com/forum/uc_server/data/avatar/000/57/84/71_avatar_middle.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">weakiwi</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="http://weakiwi.digitcv.com/#/resume">我的简历</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/weakiwi/" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/u/1750494183/home?wvr=5&lf=reg" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-termux" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/09/10/termux/" class="article-date">
  	<time datetime="2016-09-10T01:35:06.457Z" itemprop="datePublished">2016-09-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><h1 id="termux初步折腾"><a href="#termux初步折腾" class="headerlink" title="termux初步折腾"></a>termux初步折腾</h1><p>标签（空格分隔）： 折腾</p>
<hr>
<p>最近阿里云卡得我鬼火起，差点一时冲动买了小主机。突然想起安卓上的termux，据说linux大部分的特性都有了<br>。于是就有了此文。<br>首先不特别建议使用清华源，一个是我教育网内每次apt update容易走ipv6，然后无论装什么都是unable locate，直接用官方源就好了。<br>首先就是折腾ssh，因为termux不支持用户登陆，所以只能用密钥登陆。首先<code>apt install openssh</code>安装ssh服务端，接着用<code>ssh-keygen</code>生成密钥，我是一路enter所以产生的id_rsa.pub在/data/data/com.termux/files/home下面。直接用es文件浏览器考到sd卡根目录，拖到电脑上。用putty-keygen，选择“载入”，选择所有文件，然后选择id_ras，生成.ppk文件。以后登陆选上这个就好了。p.s:登陆时无须输入用户名<br>然后是折腾oh-my-zsh。首先先把curl、git等基础软件安装上。参考<a href="https://github.com/4679/oh-my-termux/blob/master/install.sh" target="_blank" rel="external">这个</a>，除了修改source.list部分，其他一步步执行就好了。<br>同时推荐一下tmux，用好了实在太爽，反正占用的资源也不多，建议安装上去。我一边用tmux两分屏，然后上屏写django，下屏显示服务器状态，不要太爽。tmux的配置文件我用是<a href="https://github.com/tony/tmux-config" target="_blank" rel="external">tony/tmux-config</a>，可惜不能用鼠标选择pane。<br>oh-my-zsh最大的爽点就是各种插件和主题啊，我现在暂时用着dst主题。直接<code>vim $HOME/.zshrc</code>然后搜索theme修改为dst就好了。按照<a href="https://www.zhihu.com/question/21418451" target="_blank" rel="external">为什么说 zsh 是 shell 中的极品</a>这篇文章配置好自动补全和高亮的插件，source完然后重启就好了。最后还是转投了fish，因为有时候zsh的速度实在太慢，而同时fish却还能接受。不过需要注意的一点是，因为fish不兼容bash，所以需要给vim配置文件设置指定的执行终端。<br>最后折腾vim，首先执行<code>$ git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim</code>。重要的一点是使用$HOME而非root，后面vimrc的配置文件也这么改就好了。最后贴上我的vim配置文件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line">if v:lang =~ &quot;utf8$&quot; || v:lang =~ &quot;UTF-8$&quot;</div><div class="line">   set fileencodings=ucs-bom,utf-8,latin1</div><div class="line">endif</div><div class="line"></div><div class="line">set nocompatible</div><div class="line">filetype off</div><div class="line">set rtp+=bundle/Vundle.vim</div><div class="line">call vundle#begin()</div><div class="line">Plugin &apos;VundleVim/Vundle.vim&apos;</div><div class="line"></div><div class="line">map &lt;F5&gt; I// &lt;ESC&gt;</div><div class="line">map &lt;F11&gt; ^xx</div><div class="line">set ts=4</div><div class="line">set autoindent</div><div class="line">set smartindent</div><div class="line">set showmatch</div><div class="line">set expandtab</div><div class="line">set nu!</div><div class="line">set nocompatible    &quot; Use Vim defaults (much better!)</div><div class="line">set bs=indent,eol,start     &quot; allow backspacing over everything in insert mode</div><div class="line">&quot;set ai         &quot; always set autoindenting on</div><div class="line">&quot;set backup     &quot; keep a backup file</div><div class="line">set viminfo=&apos;20,\&quot;50    &quot; read/write a .viminfo file, don&apos;t store more</div><div class="line">            &quot; than 50 lines of registers</div><div class="line">set history=50      &quot; keep 50 lines of command line history</div><div class="line">set ruler       &quot; show the cursor position all the time</div><div class="line"></div><div class="line">&quot; Only do this part when compiled with support for autocommands</div><div class="line">if has(&quot;autocmd&quot;)</div><div class="line">  augroup redhat</div><div class="line">  autocmd!</div><div class="line">  &quot; In text files, always limit the width of text to 78 characters</div><div class="line">  &quot; autocmd BufRead *.txt set tw=78</div><div class="line">  &quot; When editing a file, always jump to the last cursor position</div><div class="line">  autocmd BufReadPost *</div><div class="line">  \ if line(&quot;&apos;\&quot;&quot;) &gt; 0 &amp;&amp; line (&quot;&apos;\&quot;&quot;) &lt;= line(&quot;$&quot;) |</div><div class="line">  \   exe &quot;normal! g&apos;\&quot;&quot; |</div><div class="line">  \ endif</div><div class="line">  &quot; don&apos;t write swapfile on most commonly used directories for NFS mounts or USB sticks</div><div class="line">  autocmd BufNewFile,BufReadPre /media/*,/run/media/*,/mnt/* set directory=~/tmp,/var/tmp,/tmp</div><div class="line">  &quot; start with spec file template</div><div class="line">  autocmd BufNewFile *.spec 0r /usr/share/vim/vimfiles/template.spec</div><div class="line">  augroup END</div><div class="line">endif</div><div class="line"></div><div class="line">if has(&quot;cscope&quot;) &amp;&amp; filereadable(&quot;/usr/bin/cscope&quot;)</div><div class="line">   set csprg=/usr/bin/cscope</div><div class="line">   set csto=0</div><div class="line">   set cst</div><div class="line">   set csto=0</div><div class="line">   set cst</div><div class="line">   set nocsverb</div><div class="line">   &quot; add any database in current directory</div><div class="line">   if filereadable(&quot;cscope.out&quot;)</div><div class="line">      cs add $PWD/cscope.out</div><div class="line">   &quot; else add database pointed to by environment</div><div class="line">   elseif $CSCOPE_DB != &quot;&quot;</div><div class="line">      cs add $CSCOPE_DB</div><div class="line">   endif</div><div class="line">   set csverb</div><div class="line">endif</div><div class="line"></div><div class="line">&quot; Switch syntax highlighting on, when the terminal has colors</div><div class="line">&quot; Also switch on highlighting the last used search pattern.</div><div class="line">if &amp;t_Co &gt; 2 || has(&quot;gui_running&quot;)</div><div class="line">  syntax on</div><div class="line">  set hlsearch</div><div class="line">endif</div><div class="line"></div><div class="line">filetype plugin on</div><div class="line"></div><div class="line">if &amp;term==&quot;xterm&quot;</div><div class="line">     set t_Co=8</div><div class="line">     set t_Sb=^[[4%dm</div><div class="line">     set t_Sf=^[[3%dm</div><div class="line">endif</div><div class="line"></div><div class="line">&quot; Don&apos;t wake up system with blinking cursor:</div><div class="line">&quot; http://www.linuxpowertop.org/known.php</div><div class="line">let &amp;guicursor = &amp;guicursor . &quot;,a:blinkon0&quot;</div><div class="line">Plugin &apos;wakatime/vim-wakatime&apos;</div><div class="line">Bundle &apos;Shougo/vimproc&apos;</div><div class="line">Bundle &apos;Shougo/unite.vim&apos;</div><div class="line">Bundle &apos;m2mdas/phpcomplete-extended&apos;</div></pre></td></tr></table></figure></p>
<p>基本是从centos的配置改过来的，记得装vunlde</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-神箭手爬虫" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/09/10/神箭手爬虫/" class="article-date">
  	<time datetime="2016-09-10T01:35:06.453Z" itemprop="datePublished">2016-09-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><h1 id="神箭手云爬虫初体验"><a href="#神箭手云爬虫初体验" class="headerlink" title="神箭手云爬虫初体验"></a>神箭手云爬虫初体验</h1><p>标签（空格分隔）： 爬虫</p>
<hr>
<p>在一起实习的朋友推荐下尝试了一下神箭手云爬虫，感觉相当不错。首先自带函数虽然简陋，但是对于爬虫而言也算够用。导出excel功能对于我而言算是体贴。最最良心的是自带代理而且是可更换的，这个用爬虫的人都知道是多么良心了吧。<br>我用神箭手写了一个reddit的Asiancult标签的美女图爬虫，原理虽然简单，但是也跳了一些小坑。与大家分享，希望大家不要重蹈我的覆辙。<br>照例先贴代码。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> configs = &#123;</div><div class="line">    enableProxy: <span class="literal">true</span>,</div><div class="line">    domains: [<span class="string">"www.reddit.com"</span>],</div><div class="line">    scanUrls: [<span class="string">'https://www.reddit.com/r/AsianCuties/'</span>],</div><div class="line">    contentUrlRegexes: [<span class="string">"https://www\\.reddit\\.com/r/AsianCuties/.*?"</span>],</div><div class="line">    helperUrlRegexes: [<span class="string">""</span>], <span class="comment">//可留空</span></div><div class="line">    fields: [</div><div class="line">        &#123;</div><div class="line">            <span class="comment">// 第一个抽取项</span></div><div class="line">            name: <span class="string">"title"</span>,</div><div class="line">            selector: <span class="string">"//a[@class='title may-blank outbound']/@href"</span>, <span class="comment">//默认使用XPath</span></div><div class="line">            required: <span class="literal">true</span>, <span class="comment">//是否不能为空</span></div><div class="line">            repeated: <span class="literal">true</span></div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;;</div><div class="line">configs.beforeCrawl = <span class="function"><span class="keyword">function</span>(<span class="params">site</span>) </span>&#123;</div><div class="line">    site.addHeader(<span class="string">"Referer"</span>, <span class="string">"https://www.reddit.com/r/AsianCutiesl"</span>);</div><div class="line">&#125;;</div><div class="line">configs.afterDownloadPage = <span class="function"><span class="keyword">function</span>(<span class="params">page,  site</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> regex = <span class="regexp">/count=[0-9]&#123;1,4&#125;&amp;amp;after=t3_[0-9a-zA-Z]&#123;1,8&#125;/g</span>;</div><div class="line">    <span class="keyword">var</span> urls = [];</div><div class="line">    <span class="keyword">var</span> content = page.raw ;</div><div class="line">    urls = <span class="string">'https://www.reddit.com/r/AsianCuties/?'</span>+content.match(regex);</div><div class="line">    site.addUrl(urls);</div><div class="line">    <span class="built_in">console</span>.log(urls);</div><div class="line">    <span class="keyword">return</span> page;</div><div class="line">&#125;;</div><div class="line">configs.onChangeProxy = <span class="function"><span class="keyword">function</span>(<span class="params">site</span>) </span>&#123;</div><div class="line">    site.addHeader(<span class="string">"Referer"</span>, <span class="string">"https://www.reddit.com/r/"</span>)</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> crawler = <span class="keyword">new</span> Crawler(configs);</div><div class="line">crawler.start();</div></pre></td></tr></table></figure></p>
<p>其实代码结构还是比较简单的。就说下我碰到的几个坑吧。</p>
<ol>
<li>contentUrlRegexes是抓取的内容也，这个正则一定要写对啊，我一开始就是没写对，搞到网页下载下来就是不做解析。</li>
<li>afterDownloadPage。如果你也是和我一样，下一条网址是需要通过解析页面来获取的，那么请务必使用这个函数。我使用onProcessScanPage并没有生效，还有一个就是一定要return page而不是return false，因为这里返回的内容是交给爬虫来提取你要抓取的内容的。</li>
</ol>
<p>总得来说reddit的抓取还是相对简单的，没有做到什么比较惊艳的东西。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-new_spider_method" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/09/10/new_spider_method/" class="article-date">
  	<time datetime="2016-09-10T01:35:06.428Z" itemprop="datePublished">2016-09-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><h1 id="爬虫新玩法——通过队列来提高爬虫性能"><a href="#爬虫新玩法——通过队列来提高爬虫性能" class="headerlink" title="爬虫新玩法——通过队列来提高爬虫性能"></a>爬虫新玩法——通过队列来提高爬虫性能</h1><p>标签（空格分隔）： 爬虫</p>
<hr>
<p>事情的起因是亚马逊鞋品的新年优惠，其实这种所谓的优惠往往力度不大，然而再小的羊毛也是羊毛不是。因为商品太多，而且显示的还是优惠前的价格，所以人肉挑实在是太辛苦了，于是乎万能的py就必须启动了。</p>
<p>还是按照以往那样来进行需求分析：<br>1.获取优惠商品栏目下所有商品的超链接<br>2.获取这些商品的折后价格、星级还有热销排行榜，自己分别对其设置权数，算出一个综合评分。</p>
<p>，我们需要提取的商品链接的值是类似。class=’a-size-small a-color-secondary’下的，用bs4处理就好了，打开后的网页处理方法在之前的文章也提到过，在这里就不提了。这次最主要的是对爬虫的性能进行优化。</p>
<p>之前做过一个D版帖子的爬虫，也是这种先获取列表再打开类型的。一开始我采用的是非常单一的，获取完所有帖子的超链接然后再打开。唯一的优化就是采用多核心。这样做的缺点非常明显就是一单获取过程出错，后面对超链接包含内容的分析也无法进行。</p>
<p>其实最理想的处理方法就是每抓取一个超链接就分析一个超链接，百度之，发现这就是所谓的消费者生产者模型，用py现成的queue模块就能搞定。其实只要知道queue.put()是往队头插入一个元素，queue.get()是读取队尾元素并删除就好了。这样我们只要把获取超链接写成一个方法并存在队列里，对超链接的读取写成另一个方法，同时读取队列就好了。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-ndsl_1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/09/10/ndsl_1/" class="article-date">
  	<time datetime="2016-09-10T01:35:06.425Z" itemprop="datePublished">2016-09-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><h1 id="搞个大新闻！-——ndsl电池改造"><a href="#搞个大新闻！-——ndsl电池改造" class="headerlink" title="[搞个大新闻！]——ndsl电池改造"></a>[搞个大新闻！]——ndsl电池改造</h1><p>标签（空格分隔）： 电子</p>
<hr>
<p>好久没更新博客，所以就顺手做个大死，去掉ndsl的gba插槽然后塞进去一个bl5c，虽然存在电池互冲问题，但是容量也差不多能够增加百分之八十。</p>
<p>大概步骤：</p>
<ol>
<li>拆机清灰顺便换下导电胶</li>
<li>拆gba槽并且打磨后盖</li>
<li>并联不了bl5c与正负极</li>
<li>测试</li>
</ol>
<p>需要工具：</p>
<ol>
<li>拆机套件</li>
<li>电烙铁、焊锡、松香、漆包线（可以随便找条usb线去拆）等焊接工具</li>
<li>虎嘴钳、万用表</li>
<li>bl5c、海绵垫子（用来做绝缘和电池减震）、绝缘胶布、双面导电的金属铜箔（用来增大触点面积）</li>
<li>如果金钱富余建议买套备用壳，防止手贱拆坏了。</li>
</ol>
<p>拆机的话需要注意的不多，先取出所有卡，把D面所有螺丝全部卸完以后（主板上貌似还有固定螺丝），用手顶一下下屏主板就能出来了，注意别动着排线了。注意别把音量和开关机键给搞丢了，这是可以顺路把导电胶给换了（参见<a href="http://weakiwi.github.io/2015/08/10/ndsl/" target="_blank" rel="external">NDSL导电胶更换</a>）。<br>然后就是卸gba槽，因为我没有热风枪，有了也不会用，就直接用虎嘴钳来暴力拆解吧还有务必把槽上的金属片也卸掉。<br><img src="http://ww3.sinaimg.cn/large/68566be7gw1f1dwj5n8eij20qo0zk13t.jpg" alt="此处输入图片的描述"><br>先对中间用力，再对边上用力。注意别把主板弄坏了。最好能打磨一下D面对应gba槽的位置，为电池留够足够空间（防止焊点太大什么的）。<br><img src="http://ww1.sinaimg.cn/large/68566be7gw1f1dwj98hk9j20zk0qowmo.jpg" alt="此处输入图片的描述"><br>接下来是对电池的改造，如果你的bl5c的金属触点没有和它的塑料边缘齐平，请务必先打磨一下。这样贴铜箔的时候能保证接触足够充分。同时在铜箔上焊好漆包线，这些事情相对简单就不重复了。<br><img src="http://ww4.sinaimg.cn/large/68566be7gw1f1dwjbl4f7j20qo0qodll.jpg" alt="此处输入图片的描述"><br> 然后就是飞线到主板上的触点啦，首先确定你的漆包线和电池的连通性没问题，然后对电池做好绝缘处理，包一圈绝缘胶布。焊接的时候请务必在触点周围垫圈硬卡纸（一开始我用塑料片，熔点太低了，效果不好）。能防止我这一类的新手把焊锡滴到主板上。这一步完成后，再测试下触点两端是否为3.7v。<br> 测试是否成功有个简单的方法，当你并联好电池和触点后，可以插充电器充电，如果一直是红灯就说明成功了。这样之后就可以还原机器啦。顺便修一下完工图。<br> <img src="http://ww1.sinaimg.cn/large/68566be7gw1f1dwj3kormj20qo0zkjwr.jpg" alt="此处输入图片的描述"><br><img src="http://ww4.sinaimg.cn/large/68566be7gw1f1dwjal3dij20qo0zktgo.jpg" alt="此处输入图片的描述"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-howtosolve" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/09/10/howtosolve/" class="article-date">
  	<time datetime="2016-09-10T01:35:06.410Z" itemprop="datePublished">2016-09-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><h1 id="如何解决php跑大循环时候的内存耗尽问题"><a href="#如何解决php跑大循环时候的内存耗尽问题" class="headerlink" title="如何解决php跑大循环时候的内存耗尽问题"></a>如何解决php跑大循环时候的内存耗尽问题</h1><p>标签（空格分隔）： 爬虫</p>
<hr>
<p>最近认识到了php在和xpath以及mysql配合的方便性后，迫不及待地想找东西来练手。于是乎就盯上了超级玩家，而后更是惊喜地发现，该站没有做爬虫限制（连UA限制都没做），url又是非常的规律，于是就迫不及待地动手啦。</p>
<p>首先还是按惯例用chrome的xpath helper插件来对网页上的dom元素进行分析。</p>
<p>可以很快就得到对应的xpath路径，然后构造sql语句。然而这些都不是今天的重点（因为并不难啊）。<br>今天的重点是解决php的内存耗尽问题。</p>
<p>当用php跑一个大循环而且每次循环都会对数据库进行查询或者插入时，php就很容易内存耗尽。像最初的脚本，五十万的循环我仅仅是跑到三千多就停止了。至于问题是为何产生的，可以参考<a href="http://blog.csdn.net/beyondlpf/article/details/7794028" target="_blank" rel="external">PHP的内存限制 Allowed memory size of 134217728 bytes exhausted (tried to allocate 1099 bytes) in</a>以及<a href="http://developer.51cto.com/art/201510/493225.htm" target="_blank" rel="external">PHP大量数据循环时内存耗尽问题的解决方案</a>。</p>
<p>也就是说只要你每次查询都用ubuffered还有在php脚本一开始就加上<code>ini_set(&quot;memory_limit&quot;,&quot;521M&quot;);</code>就好了。然而我的脚本最后还是内存耗尽了，在百度一番后才知道是我的变量使用习惯不好。于是乎我在每次循环结束都用unset函数把变量全部释放感觉，最终这个五十万的大循环终于完完整地跑完了。其实想要进一步优化还有几个办法，比方说把整个循环拆分成若干个部分，每个部分结束就<code>mysql_close()</code>一下。又或者不要用老化的mysql模块。用新的mysqli也可能对性能有所提升</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-gmScripr" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/09/10/gmScripr/" class="article-date">
  	<time datetime="2016-09-10T01:35:06.405Z" itemprop="datePublished">2016-09-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><h1 id="油猴子脚本——豆瓣读书的图书馆插件（1）"><a href="#油猴子脚本——豆瓣读书的图书馆插件（1）" class="headerlink" title="油猴子脚本——豆瓣读书的图书馆插件（1）"></a>油猴子脚本——豆瓣读书的图书馆插件（1）</h1><p>标签（空格分隔）： 爬虫</p>
<hr>
<p>上学期就有的想法，昨天因为不想自己闲下来所以开始动手继续折腾。到今天位置也算做好大部分的内容了。也算是对假期学习php+js的一个总结吧。</p>
<p>需要的技术：</p>
<ol>
<li>油猴子脚本api——GM_xmlhttprequest（超好用！）；</li>
<li>xpath还有正则表达式（开启了新世界的大门啊喂！）；</li>
<li>xpathhelper（强大的chrome插件，以后做爬虫再也不用第三方的模块啦！）；</li>
</ol>
<p>简单的流程：</p>
<ol>
<li>获取豆瓣书籍名字；</li>
<li>提交到我的vps；</li>
<li>由我的vps向海事大学图书馆查询端口提交请求；</li>
<li>分析返回的请求再返回给脚本；</li>
<li>显示出来；</li>
</ol>
<p>差不多也就那么多事了，可以开始写代码了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ==UserScript==</span></div><div class="line"><span class="comment">// @name         豆瓣读书海事大学图书馆插件</span></div><div class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></div><div class="line"><span class="comment">// @version      0.1</span></div><div class="line"><span class="comment">// @description  一个用来在豆瓣读书页面显示大连海事大学图书馆相关藏书地以及借书号的脚本</span></div><div class="line"><span class="comment">// @author       weakiwi</span></div><div class="line"><span class="comment">// @match        https://book.douban.com/subject/*</span></div><div class="line"><span class="comment">// @grant        none</span></div><div class="line"><span class="comment">// @grant        GM_xmlhttpRequest</span></div><div class="line"><span class="comment">// ==/UserScript==</span></div></pre></td></tr></table></figure>
<p>首先看油猴子脚本开头的注释快，名称、作者、更新地址什么的都是一目了然。需要关心的是<code>@grant</code>还有<code>@match</code>前者是用来包含油猴子提供给你的内部函数的，后者是用来指定在那些页面下生效的。我需要在豆瓣读书下生效，所以对应的是<code>https://book.douban.com/subject/*</code>注意通配符。获取书籍名称非常容易，一行代码能够搞定，<code>var keyword1 = title.replace( &#39;(豆瓣)&#39;, &#39;&#39; ).trim();</code></p>
<p>接下来使用gm_xmlhttprequest模块构造get请求，提交书籍名称到我的vps。可以参考<a href="http://wiki.greasespot.net/GM_xmlhttpRequest" target="_blank" rel="external">greasepot的wiki</a>，不难写出代码，注意提交完成后的执行内容得写在onload里面。代码如下：<br>    function newztflh(book_name, book_location, book_ztflh) {<br>        this.book_name = book_name;<br>        this.book_location = book_location;<br>        this.book_ztflh = book_ztflh;<br>    }<br>    var ztflh = new newztflh(‘’,’’,’’);<br>    GM_xmlhttpRequest({<br>        method: “GET”,<br>        url: “”+keyword1,//请求的url<br>        synchronous : false,//是否为异步请求<br>        onload: function(response) {<br>            var obj = JSON.parse(response.responseText);<br>            if (obj.book_name == null) {<br>                ztflh.book_name = “找不到该书籍”;//抛出异常<br>            }<br>            else{<br>                ztflh.book_name = obj.book_name;<br>                ztflh.book_location = obj.book_location;<br>                ztflh.book_ztflh = obj.book_ztflh;<br>            }<br>            switch(location.host){//构造页面显示<br>                case “movie.douban.com”:<br>                    appendLinks(Movie_links, link)</p>
<pre><code>                link.append(&apos;&lt;br&gt;&apos;)
                    .append(&apos;&lt;span class=&quot;pl&quot;&gt;字幕链接:&lt;/span&gt;&apos;)
                    .append(
                        $(&quot;&lt;a&gt;&quot;).attr({
                            href: &quot;http://shooter.cn/search/&quot; + movieTitle,
                            target: &quot;_blank&quot;
                        }).html(&quot;Shooter&quot;)
                    );

                break;
            case &quot;book.douban.com&quot;:
                appendLinks(Book_links, link)                    
                link.append(&apos;&lt;br&gt;&apos;)
                    .append(&apos;&lt;span class=&quot;pl&quot;&gt;图书馆信息 :&lt;/span&gt;&apos;+ztflh.book_name+&apos; &apos;+ztflh.book_location+&apos; &apos;+ztflh.book_ztflh+&apos; &apos;+&apos;&lt;br/&gt;&apos;)
                break;
        }

        $(&apos;#info&apos;).append(link);
    }
});    
</code></pre><p>接下来是后端的内容，因为还不会用php的模块，所以直接用xpath来对页面进行解析。这里推荐xpathhelper，只需按下ctrl+shift+x再按下shift把鼠标移动到哪就可以显示对应的xpath，不过需要注意生成的是从根标签开始的，如果太长可以直接用”/“来代替。</p>
<p>最后是返回json数据（主要是看到v2ex上有人吐槽为何后端不能返回json数据，所以良好习惯从现在开始吧。我这数据量不大，老老实实组成数组，然后再用json_encode转换就好了。注意因为出现中文所以需要在开始加<code>header(&quot;Content-Type: text/html;charset=utf-8&quot;);//防止出现乱码</code><br>还有json_encode需要多一个参数<code>cho json_encode($arr, JSON_UNESCAPED_UNICODE);</code></p>
<p>js上再用json.parse取出就好了，实在方便的一匹啊。<br><img src="http://ww2.sinaimg.cn/large/68566be7gw1f1ql4amdlgj21hc0sxnan.jpg" alt="此处输入图片的描述"></p>
<p>todolist:</p>
<ol>
<li>返回的json增加错误代码（主要是图书馆最近在维护，希望能在后端直接判断出来）</li>
<li>生成的书籍信息更加好看一些（要是能像广州十校图书馆那样就好了）</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-4300" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/09/10/4300/" class="article-date">
  	<time datetime="2016-09-10T01:35:06.351Z" itemprop="datePublished">2016-09-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><h1 id="4300的一些折腾"><a href="#4300的一些折腾" class="headerlink" title="4300的一些折腾"></a>4300的一些折腾</h1><p>标签（空格分隔）： openwrt</p>
<hr>
<p>因为老豆那也要买一个路由器，在我的蛊惑之下，母亲大人终于拨款给家里换了一台网件4300。入手的原因是128m闪存、5gwifi、450m+300m、明月固件的支持。最后一项极大降低了折腾成本，最蛋疼的是usb竟然是1.1的，慢的让人差异。不过因为2楼的电源插座已经满了，再加上家里所谓的智能电视也不支持samba，所以最后可能还是得上树莓派。</p>
<p>todo list:<br>1.修改功率和信道，尽可能地保证全家wifi覆盖并全速上网（家里那台服役了三年的普联空心信号的情况很严重）<br>2.6in4隧道地搭建<br>3.去广告<br>4.dns本地缓存<br>5.单线多拨</p>
<p>1.第一项较为简单，直接在无线设定里面修改信道为13，功率改到最大就好了<br><img src="http://ww3.sinaimg.cn/large/68566be7gw1f0dvzrorcsj21gt0qhk4u.jpg" alt="此处输入图片的描述"><br>2.第二个主要的问题在于拨号获取的ip地址都是的动态的，而6in4隧道一般要求是静态的。还好openwrt本身支持he.net隧道的动态更新。可以参见<a href="http://tieba.baidu.com/p/2549523181" target="_blank" rel="external">【低级骗分】基于OpenWRT的6in4隧道架设研究</a>。注意opkg安装软件之前得先把源换成国内的然后执行一遍opkg update，防止出现一些莫名其妙的错误</p>
<p>3.去广告我用adbyby。安装方法<a href="http://www.adbyby.com/install.htm" target="_blank" rel="external">官网</a>讲得非常详细了，不过最后用下来感觉效果不是特别明显，但是有胜于无不是。</p>
<p>4.在网上找了说是可以用pdnsd，我直接勾了开启就没有管了，以后深入研究。</p>
<p>5.下面是重头戏，单线多拨。如果条件允许，你可以现在多台电脑上试一下能不能同时登一个账号而不掉线。如果不行直接创建虚拟网口来测试。<br><img src="http://ww1.sinaimg.cn/large/68566be7gw1f0dwdxghyij21h70q3k52.jpg" alt="此处输入图片的描述"><br>我一开始是创建了四个网口，创建完了切换到接口，设置pppoe拨号，输入自己的宽带账号密码，几个wan口都是如此设置。<br><img src="http://ww3.sinaimg.cn/large/68566be7gw1f0dwhenxmsj21hc0sbqeg.jpg" alt="此处输入图片的描述"><br>设置好了回到接口主界面，几个接口都点连接，看最后能有几个能拨上就是能几拨了。（某些运营商可能需要并发拨号才能成功，然而博主是直接双拨成功，相法使用并发不成功，所以需要并发的筒子们请自行折腾了）<br>多拨成功后别忘了勾选multiwan，确保能够叠加网速<br><img src="http://ww1.sinaimg.cn/large/68566be7gw1f0dwex03ddj21ha0ra4g3.jpg" alt="此处输入图片的描述"></p>
<p>最后，依旧是秀一波成果。20m叠加为40m，而且上行也有增加。<br><img src="http://ww3.sinaimg.cn/large/68566be7gw1f0dwlyrbsyj20jz0eb0w0.jpg" alt="此处输入图片的描述"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-pyFifaolScrpit" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/10/pyFifaolScrpit/" class="article-date">
  	<time datetime="2015-12-10T08:34:17.000Z" itemprop="datePublished">2015-12-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/10/pyFifaolScrpit/">pyFifaolScrpit</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><p> python</p>
<h1 id="用py写的fifaol3辅助脚本（2）"><a href="#用py写的fifaol3辅助脚本（2）" class="headerlink" title="用py写的fifaol3辅助脚本（2）"></a>用py写的fifaol3辅助脚本（2）</h1><p>标签（空格分隔）： python</p>
<hr>
<p>快要期末考了，所以填完这个坑以后也就扎银卡卸载游戏弃坑了。还有很多乱七八糟的坑要填啊。<br>这次主要介绍：</p>
<ol>
<li>应用pyhook获取鼠标坐标，做一个鼠标版的按键精灵</li>
<li>应用pyetesser来做ocr，实现当前拥有ep的检测</li>
</ol>
<p>经常上不了sourceforge，所以pyhook的帮助文档真是坑杀我也。需要注意的就是pyhook是用钩子的形式来获取键盘输入的，而鼠标模拟点击也同样是运用钩子的形式来进行的。虽然不是特别理解这钩子到底是什么，但是总之监听和模拟是不能同时进行。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">onWheel</span><span class="params">(event)</span>:</span></div><div class="line">    <span class="keyword">global</span> hm</div><div class="line">    nl = []</div><div class="line">    <span class="keyword">if</span> event.Wheel == <span class="number">-1</span>:</div><div class="line">        hm.UnhookMouse()</div><div class="line">        <span class="keyword">print</span> <span class="string">'stop recording...'</span></div><div class="line">        <span class="keyword">print</span> <span class="string">'after 5 sec it will start...'</span></div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">5</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>]:</div><div class="line">            <span class="keyword">print</span> i</div><div class="line">            time.sleep(<span class="number">1</span>)</div><div class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">            <span class="keyword">for</span> (x,y) <span class="keyword">in</span> mouseposition:</div><div class="line">                mouse_click(x,y)</div><div class="line">                time.sleep(distance)</div><div class="line">                <span class="keyword">print</span> <span class="string">'HIT!'</span></div><div class="line">            pressHoldRelease(<span class="string">'enter'</span>)</div><div class="line">            <span class="keyword">print</span> <span class="string">'ENTER!'</span></div><div class="line">            time.sleep(<span class="number">0.2</span>)</div><div class="line">            pressHoldRelease(<span class="string">'enter'</span>)</div><div class="line">            <span class="keyword">print</span> <span class="string">'ENTER!'</span></div><div class="line">            <span class="keyword">if</span> EXIT:</div><div class="line">                sys.exit()</div><div class="line">    <span class="keyword">return</span> <span class="keyword">True</span></div></pre></td></tr></table></figure></p>
<p>需要注意的就是其中的<figure class="highlight plain"><figcaption><span>true```也是绝对必要的。</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">处理完这个小问题，我就来谈谈我大概的解决思路啦——每次点击鼠标左键，就给两个全局变量添加参数，其中一个是当前鼠标的坐标，另一个则是```time.time()```后者是用来计算鼠标点击的时间间隔的，然后当鼠标中键往后滚动的时候脱钩，处理得到时间间隔，开始模拟点击。需要注意的是，按下鼠标左键以及中键对应的子类分别是```MouseLfetDown```以及```MouseWheel```具体的实现代码可以看[我的github][1]。</div><div class="line"></div><div class="line"></div><div class="line">还有就是ocr咯，我用的是pytesser。无他，不需要编译，不需要pip，使用起来方便（反正都是对付近似印刷体的纯数字，难度较低）。</div><div class="line">有了pytesser其他就都是小事了，直接调用就好了。贴下我的图片二值化代码以及提取纯数字的代码。</div><div class="line"></div><div class="line">```python</div><div class="line">#二值化</div><div class="line">def imgConvert(file):</div><div class="line">    im = Image.open(file)</div><div class="line">    im = im.convert(&quot;I&quot;)</div><div class="line">    im2 = Image.new(&quot;P&quot;,im.size,255)</div><div class="line">    for x in range(im.size[1]):</div><div class="line">        for y in range(im.size[0]):</div><div class="line">            pix = im.getpixel((y,x))</div><div class="line">            if pix&gt;50 and pix&lt;170: #这个区间是主要字体的颜色，可以通过qq截图获得</div><div class="line">                im2.putpixel((y,x),0)</div><div class="line">    im = im2</div><div class="line">    return im</div></pre></td></tr></table></figure></p>
<pre><code class="python"><span class="comment">#提取数字</span>
<span class="function"><span class="keyword">def</span> <span class="title">OnlyNum</span><span class="params">(s)</span>:</span>
    s = s.lower()<span class="comment">#去空格</span>
    format = <span class="string">'1234567890'</span>
    <span class="keyword">for</span> c <span class="keyword">in</span> s:
        <span class="keyword">if</span> <span class="keyword">not</span> c <span class="keyword">in</span> format:
            s = s.replace(c,<span class="string">''</span>)
</code></pre>
<p>最后照例秀下成果<br><img src="http://ww3.sinaimg.cn/large/68566be7gw1eyun8bu35vj20y80muwm0.jpg" alt="此处输入图片的描述"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-fifaolPyscript" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/11/29/fifaolPyscript/" class="article-date">
  	<time datetime="2015-11-29T06:02:42.000Z" itemprop="datePublished">2015-11-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/29/fifaolPyscript/">fifaolPyscript</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><p>python</p>
<p>#用py写的fifaol3辅助脚本（1）<br>标签（空格分隔）： python</p>
<hr>
<p>最近有些沉迷于fifaol3这网游啊，自己也不是那么极客的人，只不过之前做的东西用处都不大，这次得做些用处大的东西来更新我的博客。</p>
<p>##目标</p>
<ol>
<li>fifaol3截卡器，在转会市场，总是有一些卡，虽然明明存量很大，可是每次购买就是提示“该球员已售出”。这就是截卡器的功劳了。因此打算用python实现自动检测球员，自动购买球员，最好还能考虑价格问题。</li>
<li>fifaol3经理人脚本，其实自从出了fifaol3m，就不用刷经理人了，但是我倒霉的手机玩不了，再说也得主动多造轮子提升自己吗。需要的是自动点击按钮还有就是根据情况按下esc，跳过回放入场等。</li>
</ol>
<p>##需要用到的工具</p>
<ol>
<li>pywin32，这个不用说啦，用来获取窗口以及模拟鼠标和键盘事件</li>
<li>PIL，用来识别屏幕上的变化分析当前情况（是否有+1卡，是否在播放回放等等）</li>
<li>spy++，用来获取窗口句柄和类</li>
<li>windows自带画图，用来测量坐标。</li>
<li>qq截图，用来截图还有就是测量rgb值。</li>
</ol>
<p>##截卡器具体分析<br>其实就是不断重复买球员这个操作，这样怎么都能买得到，把操作间隔该低了就可以和一般用户抢卡啦。<br>首先为了方便测试，我们需要把fifaol调整为非全屏以及第分辨率，这样才能方便我切换窗口。<br>然后就是对购买球员的操作进行分析：<br>1.首先是切换窗口到fifaol3。<br>2.点击搜索球员——选中球员——点击购买——回车购买———回车确认。这里需要注意的就是能不用鼠标完成的操作（比如最后两步可以用回车键代替），尽量别用鼠标完成（因为鼠标需要各种测量，实在太辛苦）。如下图：<br><img src="http://ww1.sinaimg.cn/large/68566be7gw1eyhsz8cwarj21020nhthv.jpg" alt="此处输入图片的描述"></p>
<p>pywhin32在网上的资料还是很多的，直接找来就好了。直接贴下主程序的代码：</p>
<pre><code class="python"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    game_hwnd = win32gui.FindWindow(<span class="string">'FIFANG'</span>,<span class="string">'FIFA ONLINE3 - Developed by SPEARHEAD'</span>)<span class="comment">#fifaol3的窗口类和标题</span>
    win32gui.ShowWindow(game_hwnd, win32con.SW_RESTORE)<span class="comment">#窗口提前</span>
    win32gui.SetForegroundWindow(game_hwnd)
    game_rect = win32gui.GetWindowRect(game_hwnd)<span class="comment">#获取窗口的坐标，对应的是左上角坐标和右下角坐标</span>
    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):<span class="comment">#暂停五秒，方便用户把鼠标移动到搜索球员上</span>
        <span class="keyword">print</span> i
        time.sleep(<span class="number">1</span>)
    user_x,user_y = get_mouse_point()<span class="comment">#获取鼠标坐标</span>
    time.sleep(<span class="number">0.1</span>)
    moveAndclick(user_x, user_y)<span class="comment">#点击搜索球员（</span>
    time.sleep(<span class="number">1</span>)
    <span class="keyword">while</span>(<span class="number">1</span>):
            time.sleep(<span class="number">0.5</span>)
            moveAndclick(game_rect[<span class="number">0</span>]+<span class="number">579</span>, game_rect[<span class="number">1</span>]+<span class="number">226</span>)<span class="comment">#选中第一个球员</span>
            time.sleep(<span class="number">0.5</span>)
            moveAndclick(game_rect[<span class="number">0</span>]+<span class="number">717</span>, game_rect[<span class="number">1</span>]+<span class="number">572</span>)<span class="comment">#点击购买</span>
            time.sleep(<span class="number">0.5</span>)
            pressHoldRelease(<span class="string">'enter'</span>)<span class="comment">#回车确认购买</span>
            time.sleep(<span class="number">1</span>)
            pressHoldRelease(<span class="string">'enter'</span>)<span class="comment">#回车确认</span>
            time.sleep(<span class="number">0.5</span>)
            moveAndclick(user_x, user_y)<span class="comment">#点击搜索球员</span>
            time.sleep(<span class="number">3</span>)
</code></pre>
<p>缺点：</p>
<ol>
<li>没有价格识别，就是一个劲地买（一开始想截取+1图像作为区别，结果像素点太少，无论是rgb比较还是汉明距离相似度都特别高，估计只能读取内存了）</li>
<li>有时候fifaol会突然闪退回桌面，该脚本做不到再把窗口切换回去</li>
<li>操作间隔太小了fifaol会卡死。</li>
<li>不能检测延迟，只能靠不断重复来弥补。</li>
</ol>
<p>最后按照管理秀下成果吧！<br><img src="http://ww4.sinaimg.cn/large/68566be7gw1eyht3275gjj21020nhdnw.jpg" alt="此处输入图片的描述"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-betterhexo" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/11/06/betterhexo/" class="article-date">
  	<time datetime="2015-11-06T13:30:19.000Z" itemprop="datePublished">2015-11-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/06/betterhexo/">betterhexo</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->

        <script src="/assets/js/APlayer.min.js"> </script><p>折腾categories: toc:true    因为最近找不到什么素材更新博客啦，所以就转头开始折腾博客本身吧。这次对于博客的折腾，主要分为一下方面：</p>
<ol>
<li>seo优化</li>
<li>增加统计功能</li>
<li>优化显示效果</li>
<li>丰富页面内容</li>
</ol>
<p>##seo优化<br>这里主要是添加sitemap被百度等网站收录以及添加robots.txt。参考：<br><a href="http://www.arao.me/2015/hexo-next-theme-optimize-seo/" target="_blank" rel="external">动动手指，不限于NexT主题的Hexo优化（SEO篇）</a><br><a href="http://lurrpis.com/5.html" target="_blank" rel="external">Hexo的SEO，标签转为关键词，搜索优化</a><br><a href="http://wanghuanming.com/2014/12/blog-seo/" target="_blank" rel="external">个人博客SEO实践</a></p>
<p>##增加统计功能<br>主要是用了不蒜子这个js统计脚本：<br><a href="http://ibruce.info/2015/04/04/busuanzi/" target="_blank" rel="external">不蒜子</a></p>
<p>##优化显示效果<br>主要是增加字体大小</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 weakiwi
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
            <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
            </script>
            </br>本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
            <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=298 height=52 src="http://music.163.com/outchain/player?type=0&id=108987177&auto=1&height=32"></iframe>
      	</div>
    </div>
  </div>
</footer>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: undefined,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: undefined
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>